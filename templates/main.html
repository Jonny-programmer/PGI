{% extends "base.html" %}
{% block scripts %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<link href="../static/css/graphs.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="https://atuin.ru/demo/ui-slider/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://atuin.ru/demo/ui-slider/jquery-ui.css">
<script src="https://atuin.ru/demo/ui-slider/jquery.ui.touch-punch.min.js"></script>
<script>

    return_button_func = function (name){
        let a = {'next': 1, 'next2': 10, 'next3': 1000, 'last': -1, 'last2': -10, 'last3': -1000}
        return function(){
            window.current += a[name]
            $.ajax({
                url: "/",
                type: 'POST',
                data: ({
                    type: 'heatmap_button_event',
                    current: window.current,
                    pos: 'last',
                    value0: window.value0,
                    value1: window.value1
                }),
                datatype: 'text',
                success: window.funcSucces
            })
        }
    }

    window.funcSucces = function(data) {
        $("#text_id").html('You are on the frame number ' + window.current)
        console.log(window.current)
        $("#heatmap_graph").remove();
        $('<div>', {
            id: 'heatmap_graph'
        }).appendTo("#heatmaps")
        let graphs = JSON.parse(data);
        console.log(graphs);
        Plotly.plot('heatmap_graph', graphs, {});
    }

    function firstSuccess(data){
        let heatmap_graph = JSON.parse(data['heatmap']);
        let keogramm_graph = JSON.parse(data['keogram']);
        console.log(heatmap_graph)
        Plotly.plot('heatmap_graph', heatmap_graph, {});
        Plotly.plot('keogram_graph', keogramm_graph, {});
    }

    $(document).ready(function () {
        $("#next").bind("click", return_button_func('next'))
        $("#next2").bind("click", return_button_func('next2'))
        $("#next3").bind("click", return_button_func('next3'))
        $("#last").bind("click", return_button_func('last'))
        $("#last2").bind("click", return_button_func('last2'))
        $("#last3").bind("click", return_button_func('last3'))
    })
</script>

<script>
    $(document).ready(function() {
        $.ajax({
                url: "/",
                type: 'POST',
                data: ({
                    type: 'first_event',
                    first: true
                }),
                datatype: 'text',
                success: firstSuccess
            })
        window.value0 = 20000
        window.value1 = 200000

    })

</script>
{% endblock %}

{% block light_curve %}

{% endblock %}

{% block keogramm %}
<h1>Keogramm</h1>
<div class="something_and_slider">
    <div id="keogram" class="keogram">
        <div id="keogram_graph">
        </div>
    </div>
    <div></div>
    <div>
        <div id="keogram_slider" class="ui-slider-vertical"></div>
    </div>
</div>
{% endblock %}


{% block heatmap %}

<h1>Frame</h1>
<div class="something_and_slider">
    <div id="heatmaps">
        <div id="heatmap_graph">
        </div>
    </div>
    <div></div>
    <div>
        <div id="heatmap_slider" class="ui-slider-vertical"></div>
        <div id="first_text" class="slider_text">dghth</div>
        <div id="second_text" class="slider_text">dghth</div>
    </div>
</div>
<script>
    window.current = 1;
</script>

<script>
    $( ".ui-slider-vertical" ).slider({
    animate: 100,
    range: "min",
    min: 20000,
    max: 500000,
    values: [20000, 200000],
    orientation: "vertical",
    step: 10000
    });


    text_position = function(value){
        let left_pos = $( "#heatmap_slider" ).offset().left + 1.8 * $( "#heatmap_slider" ).width();
        let a = 450 - $( "#heatmap_slider" ).height() * ((value - 20000) / 480000)
        let top_pos = $( "#heatmap_slider" ).offset().top + a - 15;
        return [left_pos, top_pos]
    }

    change_pos = function(value, id){
        $(id).offset({top: text_position(value)[1], left: text_position(value)[0]});
        $(id).text(value / 1000 + 'K')
    }

    $( "#heatmap_slider" ).slider({
    slide: function( event, ui ) {
        change_pos(ui.values[0], " #first_text ");
        change_pos(ui.values[1], " #second_text ");
        window.value0 = ui.values[0];
        window.value1 = ui.values[1];
        $.ajax({
                url: "/",
                type: 'POST',
                data: ({
                    type: 'heatmap_slider_event',
                    value0: ui.values[0],
                    value1: ui.values[1],
                    current: window.current
                }),
                datatype: 'text',
                success: window.funcSucces
            })
    }
});

    $(document).ready(function() {
        console.log('aergaerf')
        change_pos(20000, " #first_text ");
        change_pos(200000, " #second_text ");
        window.value0 = 20000;
        window.value1 = 200000;
        })



</script>

<center>
    <h5 class="header" id="text_id">You are on the frame number 0</h5>
    <div class="btn-group" role="group" aria-label="Basic example">
        <button type="button" class="btn btn-primary" id="last3">
            <<<
        </button>
        <button type="button" class="btn btn-primary" id="last2">
            <<
        </button>
        <button type="button" class="btn btn-primary" id="last">
            <
        </button>
        <button type="button" class="btn btn-primary" id="next"> ></button>
        <button type="button" class="btn btn-primary" id="next2"> >></button>
        <button type="button" class="btn btn-primary" id="next3"> >>></button>
    </div>
</center>
{% endblock %}

